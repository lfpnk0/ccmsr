<script>
  function pkAlert(){
    this.time = 0;
    this.items = [];
    this.getTime = function(){
      d=new Date();
      month=d.getMonth();
      month++;
      day=d.getDate();
      year=d.getFullYear();
      this.strDate = month+"/"+day+"/"+year;
      h=parseInt(d.getHours());
      m=parseInt(d.getMinutes());
      s=parseInt(d.getSeconds());
      this.time = this.time2seconds(h,m,s);
    }
    this.time2seconds = function(h,m,s){
      x=s+(m*60)+(h*60*60);
      return x;
    }
    this.seconds2time = function(seconds,format){
      minutes=Math.floor(seconds/60);
      seconds=seconds-(minutes*60);
      hours=Math.floor(minutes/60);
      minutes=minutes-(hours*60);
      x=[hours,minutes,seconds];
      y=this.formatTime(x,format);
      return y;
    }
    this.formatTime = function(t,format){
      hr=t[0];
      min=t[1];
      sec=t[2];
      switch (format){
        case '12short':
          if(hr>12){
            hr=t[0]-12;
            p='pm';
          }
          else{
            p='am';
          }
          r=this.padNum(hr)+':'+this.padNum(min)+' '+p;
          break;
        case 24:
          r=this.padNum(hr)+':'+this.padNum(min)+':'+this.padNum(sec);
          break;
        case '24short':
          r=this.padNum(hr)+':'+this.padNum(min);
          break;
        case 12:
          if(hr>12){
            hr=t[0]-12;
            p='pm';
          }
          else{
            p='am';
          }
          r=this.padNum(hr)+':'+this.padNum(min)+':'+this.padNum(sec)+' '+p;
          break;
      }
      return r;
    }
    this.padNum = function(n){
      n=n.toString();
      if(n.length<2){
        n='0'+n;
      }
      return n;
    }
    this.openAForm = function(){
      document.getElementById('aForm').style.display='block';
    }
    this.closeAForm = function(){
      document.getElementById('alertLabel').value="label";
      document.getElementById('alertHour').value="";
      document.getElementById('alertMin').value="";
      document.getElementById('alertPer').value="pm";
      document.getElementById('aForm').style.display='none';
    }
    this.saveAForm = function(){
      a=new Object();
      a.label = document.getElementById('alertLabel').value;
      e = document.getElementById('alertPer');
      if(e.options[e.selectedIndex].value == 'pm'){
        a.hour = (document.getElementById('alertHour').value*1)+12;
      }
      else{
        a.hour = document.getElementById('alertHour').value;
      }
      a.min = document.getElementById('alertMin').value;
      a.time = this.time2seconds(a.hour,a.min,0);
      a.timer = false;
      a.rung = false;
      this.items.push(a);
      this.closeAForm();
    }
    this.update = function(){
      e = document.getElementById("reminder");
      timeOffset = e.options[e.selectedIndex].value;
      active = 0;
      this.getTime();
      this.items.sort(function(a,b) {return (a.time > b.time) ? 1 : ((b.time > a.time) ? -1 : 0);} );
      this.buildDisp();
      for (i = 0; i < this.items.length; i++) {
        timeRemain = this.items[i].time-this.time;
        e=document.getElementById('alert-'+i);
        e.getElementsByClassName('aLabel')[0].innerHTML=this.items[i].label;
        e.getElementsByClassName('aTime')[0].innerHTML=this.seconds2time(this.items[i].time,'12short');
        e.getElementsByClassName('aCountdown')[0].innerHTML=this.seconds2time(timeRemain,24);
        if(this.items[i].timer){
          e.getElementsByClassName('aTimer')[0].innerHTML=this.seconds2time(this.time-this.items[i].timer,24);
        }
        else{
          e.getElementsByClassName('aTimer')[0].innerHTML="00:00:00";
        }
        if(!this.items[i].rung){
          if(timeRemain-timeOffset<1){
            alert(this.items[i].label+' coming in '+this.seconds2time(timeRemain,24));
            this.items[i].rung=true;
          }
        }
        if(this.items[i].rung){
          active = i+1;
        }
      }
      document.getElementById('alertDate').innerHTML = this.strDate;
      document.getElementById('alertTime').innerHTML = this.seconds2time(this.time,12);
      if(this.items.length>active){
        document.getElementById('alertTitle').innerHTML = this.seconds2time(this.items[active].time-this.time,24)+' - '+this.items[active].label;
        document.title = this.seconds2time(this.items[active].time-this.time,24)+' - '+this.items[active].label;
      }
      else{
        document.getElementById('alertTitle').innerHTML = 'Alerts';
        document.title = 'Mouser';
      }
    }
    this.buildDisp = function(){
      d = document.getElementsByClassName('aItem');
      a = this.items;
      if(d.length!=a.length){
        myNode = document.getElementById('aItemsWrapper')
        myNode.innerHTML = "";
        for (i = 0; i < a.length; i++) {
          html = ''+
            '<div class="dd-opt aItem" id="alert-'+i+'">'+
            '<div class="dd-sub aItemDetail" style="width:80%;">'+
            '<span class="aLabel">label</span><br/>'+
            '<span class="aTime">time</span><br/>'+
            '<span class="aCountdown" onclick="eventAlerts.aTimer('+i+');"></span>'+
            '<span class="aTimer" onclick="eventAlerts.aTimer('+i+');">00:00:00</span>'+
            '</div>'+
            '<div class="dd-sub dd-opt-button" style="width:20%;">'+
            '<span class="wingdings" onclick="eventAlerts.delAlert('+i+');">V</span></br>'+
            '<span class="wingdings" onclick="eventAlerts.editAlert('+i+');">!</span>'+
            '</div>'+
            '<div class="clear"></div>'+
            '</div>';
          myNode.innerHTML = myNode.innerHTML+html;
        }
      }
    }
    this.delAlert = function(id){
      this.items.splice(id, 1);
    }
    this.editAlert = function(id){
      this.openAForm();
      document.getElementById('alertLabel').value=this.items[id].label;
      hour = this.items[id].hour;
      if(hour>12){
        hour = hour-12;
        period = 'pm';
      }
      else{
        period = 'am';
      }
      document.getElementById('alertHour').value=hour;
      document.getElementById('alertMin').value=this.items[id].min;
      document.getElementById('alertPer').value=period;
      this.items.splice(id, 1);
    }
    this.aTimer = function(id){
    a = document.getElementById('alert-'+id);
    if(a.getElementsByClassName('aCountdown')[0].style.display=='none'){
      a.getElementsByClassName('aCountdown')[0].style.display='inline';
      a.getElementsByClassName('aTimer')[0].style.display='none';
      this.items[id].timer = false;
    }
    else{
      a.getElementsByClassName('aCountdown')[0].style.display='none';
      this.items[id].timer = this.time;
      a.getElementsByClassName('aTimer')[0].style.display='inline';
    }
  }
}
</script>
<style>
  #alertLabel{
    text-align:center;
  }
  #alertHour, #alertMin{
    width:2em;
  }
  .aItemDetail{
    line-height:1.333333em;
  }
  #aForm{
    width:100%;
    display:none;
  }
  .aLabel{
    padding-left:0.5em;
  }
  .aTime{
    padding-left:0.5em;
  }
  .aCountdown{
    padding-left:0.5em;
  }
  .aTimer{
    padding-left:0.5em;
    display:none;
  }
</style>
<div class="dd dd-closed" id="myAlerts">
  <span class="dd-title" id="alertTitle" onclick="eventAlerts.closeAForm();">Alerts</span>
  <div class="dd-opt">
    <div class="dd-sub" style="width:100%;">
      <span id="alertDate">date</span> <span id="alertTime">time</span>
    </div>
  </div>
  <div class="dd-opt">
    <div class="dd-sub" style="width:100%;">
      <select id="reminder">
        <option value=0>0 Minutes</option>
        <option value=300 selected=selected>5 Minutes</option>
      </select>
      <span  style="border:1px solid black;padding:0px 0.25em 0px 0.25em;font-weight: bold;" onclick="eventAlerts.openAForm();">+</span>
    </div>
  </div>
  <div class="dd-opt">
    <div class="dd-sub" id="aForm">
      <input type="text" id="alertLabel" value="label" /><br/>
      <input type="text" id="alertHour" />
      <input type="text" id="alertMin" />
      <select id="alertPer">
        <option value="am">AM</option>
        <option value="pm" selected=selected>PM</option>
      </select><br/>
      <input type="button" onclick="eventAlerts.saveAForm();" value="Save" />
      <input type="button" onclick="eventAlerts.closeAForm();" value="Clear" />
    </div>
    <div class="clear"></div>
  </div>
<div class="controlItem" id="aItemsWrapper">
  <div class="clear"></div>
  </div>
</div>
